---

# ğŸ“Œ Fiche pratique â€“ GROUP BY

## ğŸ”¹ DÃ©finition

`GROUP BY` permet de **regrouper les lignes** dâ€™une table selon une ou plusieurs colonnes, pour ensuite appliquer des **fonctions dâ€™agrÃ©gation** (`COUNT`, `SUM`, `AVG`, `MIN`, `MAX`â€¦).
ğŸ‘‰ Câ€™est lâ€™Ã©quivalent dâ€™un **groupby en pandas**.

---

## ğŸ”¹ Syntaxe SQL

```sql
SELECT colonne1, fonction_agregat(colonne2)
FROM table
GROUP BY colonne1;
```

---

## ğŸ”¹ Exemple SQL

Table `ventes` : `(client, montant)`

```sql
SELECT client, SUM(montant) AS total_achats
FROM ventes
GROUP BY client;
```

ğŸ“Š RÃ©sultat : un total des achats par client.

âš ï¸ Si on utilise `GROUP BY`, **toutes les colonnes du SELECT** doivent Ãªtre :

* soit dans le `GROUP BY`
* soit utilisÃ©es dans une fonction dâ€™agrÃ©gation.

---

## ğŸ”¹ Clause HAVING

`HAVING` filtre **aprÃ¨s** lâ€™agrÃ©gation (contrairement Ã  `WHERE`, qui filtre avant).

```sql
SELECT client, SUM(montant) AS total_achats
FROM ventes
GROUP BY client
HAVING SUM(montant) > 500;
```

---

## ğŸ”¹ Ã‰quivalent en Python (pandas)

```python
import pandas as pd

ventes = pd.DataFrame({
    "client": ["Alice", "Bob", "Alice", "ChloÃ©", "Bob"],
    "montant": [100, 50, 200, 300, 150]
})

# Group by client et somme des montants
resultat = ventes.groupby("client")["montant"].sum().reset_index()

print(resultat)
```

ğŸ“Š RÃ©sultat : mÃªme logique que SQL â†’ total des achats par client.

---

âœ… **Ã€ retenir** :

* `GROUP BY` = regroupe les donnÃ©es.
* Toujours avec une fonction dâ€™agrÃ©gation.
* `HAVING` = filtre aprÃ¨s regroupement.
* En Python â†’ `groupby()` de pandas.

---

**EXERCICES**

Imaginons qu'on ait une table de ventes avec le montant dÃ©pensÃ© par chaque client pour chaque opÃ©ration:
On aimerait savoir qui est notre plus gros client, pour lui envoyer un cadeau.
<br />

Pour cela, il nous faut, pour chaque client, la somme de ses dÃ©penses